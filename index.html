<script>
const board = document.getElementById("board");
const size = 15;
const gap = 30;

let currentPlayer = "black"; // black or white
let isPlayerTurn = true;
let chess = Array.from({ length: size }, () => Array(size).fill(null));

/* 選擇先後手 */
if (!confirm("你要先手（黑棋）嗎？\n按取消則你後手（白棋）")) {
  currentPlayer = "white";
  isPlayerTurn = false;
  setTimeout(computerMove, 500);
}

/* 畫棋盤線 */
for (let i = 0; i < size - 1; i++) {
  const h = document.createElement("div");
  h.className = "line horizontal";
  h.style.top = `${i * gap}px`;
  board.appendChild(h);

  const v = document.createElement("div");
  v.className = "line vertical";
  v.style.left = `${i * gap}px`;
  board.appendChild(v);
}

/* 建立交點 */
for (let y = 0; y < size; y++) {
  for (let x = 0; x < size; x++) {
    const point = document.createElement("div");
    point.className = "point";
    point.style.left = `${x * gap}px`;
    point.style.top = `${y * gap}px`;

    point.addEventListener("click", () => {
      if (!isPlayerTurn) return;
      if (chess[y][x]) return;

      placeStone(x, y, currentPlayer);
      chess[y][x] = currentPlayer;

      switchTurn();
      setTimeout(computerMove, 300);
    });

    board.appendChild(point);
  }
}

/* 星位 */
[
  [3,3],[3,11],[7,7],[11,3],[11,11]
].forEach(([x,y]) => {
  const s = document.createElement("div");
  s.className = "star";
  s.style.left = `${x * gap}px`;
  s.style.top = `${y * gap}px`;
  board.appendChild(s);
});

/* 放棋子 */
function placeStone(x, y, color) {
  const stone = document.createElement("div");
  stone.className = `stone ${color}`;
  stone.style.left = `${x * gap}px`;
  stone.style.top = `${y * gap}px`;
  board.appendChild(stone);
}

/* 換手 */
function switchTurn() {
  currentPlayer = currentPlayer === "black" ? "white" : "black";
  isPlayerTurn = !isPlayerTurn;
}

/* 電腦下棋（簡單隨機） */
function computerMove() {
  if (isPlayerTurn) return;

  let empty = [];
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      if (!chess[y][x]) empty.push([x, y]);
    }
  }

  if (empty.length === 0) return;

  const [x, y] = empty[Math.floor(Math.random() * empty.length)];

  placeStone(x, y, currentPlayer);
  chess[y][x] = currentPlayer;

  switchTurn();
}
</script>
